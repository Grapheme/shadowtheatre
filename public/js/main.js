var shadowPaths = {
	euphoria :  "M318.424,229.035c0.143-0.341,0.188-1.45-0.357-1.549 c-3.365-0.613-11.688,0.863-16.299,0.376c-11.928-1.259-23.533-4.411-35.648-4.411c-6.881,0-12.615-0.826-19.277-1.737 c-8.17-1.118-16.857-0.571-25.229-0.593c-10.38-0.027-21.179,1.363-31.314,2.375c-9.85,0.983-19.412-0.208-29.125-1.25 c-9.42-1.01-19.742-1.452-28.9-4.216c-4.764-1.438-8.234-1.46-14.474-2.784c-3.103-0.658-15.04-7.543-19.174-11.956 c-6.951-7.419-6.492-13.63-2.389-22.544c0.211-0.458,0.583-1.267,1.021-2.239c0.182,0.1,4.829,2.951,7.166,3.094 c5.137,0.316,11.291-5.864,18.405-19.539c1.215-2.335,1.639-5.391,2.763-7.589c2.646-5.175,4.388-9.604,4.879-12.732 c2.675-17.031-8.903-25.101-20.243-27.664c-0.179-0.435-0.405-0.856-0.657-1.271c-2.388-16.943-37.655-6.75-32.703,8.651 c0.02,2.057,0.867,4.019,2.897,5.676c0.046,0.038,0.093,0.067,0.14,0.104c-1.258,2.308-2.293,4.912-3.002,7.871 c-1.154,4.818-0.674,9.61,0.325,14.41c0.674,3.24,1.759,6.285,1.876,9.629c0.071,2-0.628,4.049-1.546,5.972 c-0.335,0.57-0.665,1.143-0.991,1.717c-1.265,2.003-2.414,4.036-3.42,5.994c-1.966,3.83-3.879,7.637-6.871,10.786 c-1.603,1.688-6.432,3.719-9.059,2.229c-3.765-15.525,0.412-50.49-1.301-74.738c-0.352-4.977,0.622-10.022,0.852-14.984 c0.459-9.931-0.595-19.875,1.752-29.583c2.121-8.782,5.387-17.333,7.656-26.082c1.68-6.476,4.734-11.125,7.758-17 c0.949-1.848,1.677-3.649,2.492-5.594c1.553-3.701,5.635-8.615,5.568-9.244c-0.17-1.62-1.936-1.262-1.936-1.262 s0.4-0.664,2.511-2.938c0.855-0.922,0.105-2.047-2.207-1.297c0.626-0.947,2.25-2.125,1.5-3c-0.257-0.3-2-0.25-2.938,0.375 c1.038-1.083-1.05-1.943-2.677-1.243c-2.886,1.243-8.18,5.126-10.666,7.625c-3.538,3.558-7.49,12.54-12.407,13.909 c-2.707,0.728-6.419-5.286-6.926-8c-1.512-8.104-3.621-9.128-5.012-9.542c-4-1.188,0.101,11.001,1.345,16.134 c1.297,5.353,3.199,11.202,3.26,16.999c0.044,4.241,0.115,8.513,0,12.752c-0.143,5.251-7.497,32.75-8.944,43.224 c-1.026,7.423-1.459,13.571-0.48,26.692c0.42,5.628-3.908,27.074-5.241,54.241c-0.773,15.758-0.979,29.991-3.167,33.5 c-3.563,5.294-7.318,12.22-11.015,18.121c-3.261,5.205-3.876,11.67-4.152,17.788c-0.611,13.523,2,16.758,1.334,36.87 c-0.279,8.444-1.873,20.336-4.334,28.555c-2.907,9.709-5.998,20.008-9.333,45.667c-1.331,10.241,0.131,19.378,2.26,29.583 c2.776,13.303,15.573,46.416,32.573,67.082c2.226,2.705,5.037,6.701,10.334,8.668c6.932,2.572,11.676,3.418,16.5-1.5 c3.823-3.9,6.408-9.664,9.5-14.168c0.787,1.725,6.924,11.326,8.563,12.943c2.378,2.344,6.66,4.219,9.612,6.049 c8.781,5.449,17.59,10.945,25.991,17.008c9.989,7.209,17.317,11.9,26.833,19.834c6.584,5.49,16.432,13.621,22.24,19.834 c4.324,4.625,9.342,8.018,14.258,12.074c5.742,4.734,10.438,10.834,16.326,15.611c2.855,2.314,5.609,4.543,8.074,7.314 c1.328,1.496,4.02,6.174,6.275,6.006c4.547-0.338,6.279-13.162,5.492-16.34c-2.883-11.627-14-13.334-18.666-25 c-2.014-5.033-3.209-10.312-8.41-13.426c-4.299-2.57-11.219-2.105-16.076-3.574c-11.789-3.564-21.967-17.654-29.355-26.592 c-4.842-5.855-9.006-12.346-14.568-17.48c-4.938-4.559-10.227-7.951-16.076-11.504c-4.373-2.654-12.143-5.428-14.957-9.758 c-1.494-2.301-6.434-17.799-7.557-21.332c3.166-6.076,13.68-19.447,16.5-23.834c13.5-21,14.476-20.089,23.832-27.833 c5.438-4.499,11.648-8.635,14.834-13c2.004-2.746,9.502-10.734,12-13.167c4.637-4.517,6.594-6.939,5.598-8.166 c-3.365-4.143-16.062-3.86-20.598-1.5c-6.408,3.336-9.125,7.534-14.316,12.241c-5.391,4.888-10.764,6.537-17.025,9.683 c-5.594,2.81-9.728,4.378-9.992,11.243c-0.27,7.023,1.59,11.106-2.999,16.333c-4.042,4.604-4.729,2.181-15.901,14.807 c-3.832-27.333-2.19-30.325-2.242-42.739c-0.109-26.378-19.023-30.733-8.189-55.4c3.268-7.439,5.896-12.509,9.666-18.167 c3.982-5.975,7.344-9.115,13.018-14.174c4.718-4.208,10.857-8.308,16.574-11.075c18.098-8.76,40.061-7.583,59.846-7.583 c9.393,0,18.412,1.902,27.889,2c13.633,0.14,27.068-3.492,40.365-6.009c7.354-1.392,13.732-1.927,20.055-2.918 c4.861-0.762,11.521-1,15.607,2.015c9.207,6.795,19.18,15.446,22.547,12.508c2.139-1.866-1.035-2.407-4.598-6.226 c-3.244-3.478-8.197-5.074-6.084-7.758c0.244-0.31,0.945-0.878,1.416-1.026c1.777-0.559,10.803,0.68,14.584,0.838 c4.084,0.172,12.635-0.859,13.965-1.46c2.461-1.113,2.66-2.05,1.68-2.515c-0.564-0.267-4.273-0.231-6.514-0.229 C314.662,231.291,317.893,230.316,318.424,229.035z"
};

$(window).load(function() {
	var part = location.pathname.substring(0, location.pathname.lastIndexOf("/")+1);
	if(part[0] === '/') {
		part = part.substring(1);
	}

	socket = io.connect(location.origin, {
		resource : part + "socket.io"
	});

	//gotoShadow();
	//gotoFinal();

    $(".left-arrow").bind("touchstart", function(e) {
    	$(".fotorama").data("fotorama").show('<');
    });

    $(".right-arrow").bind("touchstart", function() {
    	$(".fotorama").data("fotorama").show('>');
    });

	function drawpath( canvas, pathstr, duration, attr, callback ) {
	    var guide_path = canvas.path( pathstr ).attr( { stroke: "none", fill: "none" } );
	    var path = canvas.path( guide_path.getSubpath( 0, 1 ) ).attr( attr );
	    var total_length = guide_path.getTotalLength( guide_path );
	    var last_point = guide_path.getPointAtLength( 0 );
	    var start_time = new Date().getTime();
	    var interval_length = 500;
	    var result = path;        

	    var interval_id = setInterval( function()
	    {
	        var elapsed_time = new Date().getTime() - start_time;
	        var this_length = elapsed_time / duration * total_length;
	        var subpathstr = guide_path.getSubpath( 0, this_length );            
	        attr.path = subpathstr;

	        path.animate( attr, interval_length );
	        if ( elapsed_time >= duration )
	        {
	            clearInterval( interval_id );
	            if ( callback != undefined ) callback();
	                guide_path.remove();
	        }                                       
	    }, interval_length );  
	    return result;
	};




	var $i = 1;
	$('.app-button').each(function(){
		if($i == 10) $i = 0;
		$(this).attr('data-number', $i);
		$i++;
	});


	function appButtonClick(e) {
		$(this).addClass('active');
		typeThis($(this).attr('data-number'));
	}

	function appButtonOut() {
		$(this).removeClass('active');
	}

	$('.app-button').bind( "touchstart", appButtonClick);

	$('.app-button').bind( "touchend", appButtonOut);

	$('.final-click').bind('touchstart',function(){
		window.socket.emit("message", "Эйфория");


	 	drawpath(window.paper, shadowPaths.euphoria, 4000, {
	 	 	 "stroke" : "white"
	 	}, function() {});

	 	setTimeout(function() {
		gotoFinal();

			setTimeout(function() {
			gotoMain();
			clearType();
			}, 10000);
		}, 6000);
	});


	function gotoShadow() {
		window.socket.emit("message", "Внимание");

		$('<img/>').attr('src', 'img/deluxe1.png').load(function() {
			$('.main').fadeOut(function(){
				$('.shadow').fadeIn();
			});
		});
	}


	window.paper = Raphael( $(".canvas-container")[0], 600, 600);
	var telka = paper.path( shadowPaths.euphoria );
	telka.attr("fill", "#000000");

	function gotoFinal() {

		$('.shadow').fadeOut();
		$('.final').fadeIn();
	}

	function gotoMain() {
		socket.emit("message", "");

		$(".final").fadeOut();
		$(".main").fadeIn();
	}

	var pass = "";
	var pass_allow = true;

	function typeThis(number) {
		if(pass_allow) {
			if ( $('.closed')[0] ) {
				$('.closed').last().next().html(number).addClass('closed');
			} else {
				$('.typing-div span').first().html(number);
				$('.typing-div span').first().addClass('closed');
			}
			pass += number;
			if(pass.length == 4) {

				$.post("password", {password : pass})
				.done(function() {
					pass = "";
					gotoShadow();
				})
				.fail(function() {
					pass_allow = false;
					clearType();
					pass = "";
				});
			}
		}
	}

	function clearType() {
		$('.app-button').effect("shake", {times: 3, distance: 10}, function(){
			$('.closed').html('*').removeClass('closed');
			setTimeout(function() { pass_allow = true; }, 300);
		});
	}

	$(document).bind('touchmove', false);

});
